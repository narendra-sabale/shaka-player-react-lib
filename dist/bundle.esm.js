import e from"react";function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?s(e):t}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var o=i(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}var l=require("shaka-player/dist/shaka-player.ui.js"),f=function(n){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(d,e.PureComponent);var r,i,c,f=u(d);function d(t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(n=f.call(this,t)).videoRef=e.createRef(),n.videoContainer=e.createRef(),n.onErrorEvent=n.onErrorEvent.bind(s(n)),n.onError=n.onError.bind(s(n)),n}return r=d,(i=[{key:"onErrorEvent",value:function(e){this.onError(e.detail)}},{key:"onError",value:function(e){console.error("Error code",e.code,"object",e)}},{key:"componentDidMount",value:function(){var e=this.props,t=e.src,n=e.srcKey,r=e.authToken,i=e.seekTime,a=void 0===i?0:i,s=e.streamingConfig,c=e.abrConfig,u=e.restrictions,f=void 0===u?{}:u,d=e.drmConfig,p=e.uiConfig,h=e.onVideoEnd,v=e.onPlayFailed,m=e.getCurrentSeekTime,y=e.removeRightClick,b=e.disableControls,g=e.disableConsoleControls,E=this.videoRef.current,k=this.videoContainer.current,O=new l.Player(E);if(O.configure({streaming:o({},s),abr:o({},c),drm:o({},d),restrictions:o({},f)}),O.getNetworkingEngine().registerRequestFilter((function(e,t){2===e&&(t.uris[0]+="/".concat(n),t.headers["Content-Type"]="application/octet-stream",t.headers.Authorization="Bearer ".concat(r))})),new l.ui.Overlay(O,k,E,p).configure(p),b?(E.controls=!1,E.hasAttribute("controls")&&E.removeAttribute("controls"),E.style.pointerEvents="none"):E.controls=!0,y&&E.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),g&&(E.addEventListener("pause",(function(){E.play()})),E.addEventListener("timeupdate",(function(e){!0===e.currentTarget.controls&&(e.currentTarget.controls=!1)}))),E.onloadedmetadata=function(){!isNaN(a)&&a>E.duration&&h&&h()},E.addEventListener("loadeddata",(function(){var e;m&&m(),isNaN(a)||(E.currentTime=a),E.paused&&void 0!==(e=E.play())&&e.then((function(e){})).catch((function(){v&&v()}))})),O.addEventListener("error",this.onErrorEvent),O.load(t).then((function(){console.log("The video has now been loaded!")})).catch(this.onError),document.getElementsByClassName("shaka-video-container")[0].setAttribute("shaka-controls","true"),!document.getElementsByClassName("shaka-skim-container")[0]){var j=document.createElement("div");j.setAttribute("class","shaka-skim-container"),document.getElementsByClassName("shaka-controls-container")[0].insertBefore(j,document.getElementsByClassName("shaka-bottom-controls")[0])}var C=document.getElementsByClassName("shaka-settings-menu");C[0].classList.contains("shaka-hidden")||C[0].classList.add("shaka-hidden"),C[1].classList.contains("shaka-hidden")||C[1].classList.add("shaka-hidden")}},{key:"componentDidUpdate",value:function(e){if(e.seekTime!==this.props.seekTime){var t=this.videoRef.current;if(t.duration&&!isNaN(seekTime)){var n=this.props,r=n.seekTime,o=n.onVideoEnd;r>t.duration?o&&o():(t.currentTime=r,t.play())}}}},{key:"render",value:function(){var t=this.props.src;return e.createElement("div",{className:"video-container",ref:this.videoContainer},e.createElement("video",{className:"shaka-video",ref:this.videoRef,src:t,autoPlay:!0,style:{maxWidth:"100%"},playsInline:!0}))}}])&&t(r.prototype,i),c&&t(r,c),d}();export default f;
